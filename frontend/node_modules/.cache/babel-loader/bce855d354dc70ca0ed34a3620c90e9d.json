{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\Users\\\\HP\\\\Desktop\\\\SmartFarm app\\\\backoffice\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"C:\\\\Users\\\\HP\\\\Desktop\\\\SmartFarm app\\\\backoffice\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"C:\\\\Users\\\\HP\\\\Desktop\\\\SmartFarm app\\\\backoffice\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nimport React, { useEffect, useState } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport api from '../api/api';\n\nvar useSensorData = function useSensorData() {\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      sensorData = _useState2[0],\n      setSensorData = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      allDataSensor = _useState4[0],\n      setAllDataSensor = _useState4[1];\n\n  var location = useLocation();\n  var userId = location.pathname.split('/')[2];\n  var userUid = JSON.parse(localStorage.getItem('user')).id;\n  var fieldUid = localStorage.getItem('Field');\n  var url = '/sensor/sensor-update-data';\n\n  if (JSON.parse(localStorage.getItem('user')).role === \"ROLE_SUPPLIER\" && location.pathname === \"/Fields/\".concat(userId, \"/\").concat(fieldUid)) {\n    url = '/supplier/sensor-data';\n  }\n\n  if (JSON.parse(localStorage.getItem('user')).role === \"ROLE_SUPPLIER\" && location.pathname === \"/Dashboard-supplier\") {\n    url = '/supplier/get-sensors-data';\n  }\n\n  var data = {\n    userUid: userUid,\n    fieldUid: fieldUid,\n    userId: userId\n  };\n\n  var getDataSensor = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var response, sensors, dataMappings, updatedSensorData;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return api.post(url, data);\n\n            case 3:\n              response = _context.sent;\n              sensors = response.data.sensors;\n              dataMappings = response.data.dataMapping;\n              updatedSensorData = sensors.map(function (sensor) {\n                var valaueAfterMapping = [];\n                var mappedCharge = 0;\n                var date = sensor.time;\n                var vals = [sensor.mv1, sensor.mv2, sensor.mv3];\n\n                if (sensor) {\n                  var chargeMin = 73;\n                  var chargeMax = 100;\n                  mappedCharge = ((Number(sensor.charge) - chargeMin) / (chargeMax - chargeMin) * 100).toFixed(2);\n                  mappedCharge = Math.max(0, Math.min(100, mappedCharge));\n                }\n\n                dataMappings.forEach(function (dataMapping) {\n                  var dateMappings = dataMapping.date;\n                  var num = vals.length;\n                  var dateMappingSelected = dateMappings[\"Mv\".concat(num, \"_date\")] || \"\";\n\n                  if (dateMappingSelected !== \"\") {\n                    var keyDataMax = \"Mv\".concat(num, \"_max\");\n                    var keyDataMin = \"Mv\".concat(num, \"_min\");\n\n                    if (dateMappingSelected === dateMappings[\"Mv\".concat(num, \"_date\")]) {\n                      vals.forEach(function (val, index) {\n                        valaueAfterMapping[index] = val;\n\n                        if (val >= parseFloat(dataMapping.max[keyDataMax]) && val <= parseFloat(dataMapping.min[keyDataMin])) {\n                          valaueAfterMapping[index] = ((parseFloat(val) - dataMapping.min[keyDataMin]) / (dataMapping.max[keyDataMax] - dataMapping.min[keyDataMin]) * 100).toFixed(2);\n                        } else if (val < parseFloat(dataMapping.max[keyDataMax])) {\n                          valaueAfterMapping[index] = 100;\n                        } else if (val > parseFloat(dataMapping.min[keyDataMin])) {\n                          valaueAfterMapping[index] = 0;\n                        }\n                      });\n                    }\n                  }\n                });\n                return {\n                  code: sensor.code,\n                  sensor_id: sensor.sensor_id,\n                  time: sensor.time,\n                  temperature: sensor.temperature,\n                  humidity: sensor.humidity,\n                  pressure: sensor.pressure,\n                  charge: mappedCharge,\n                  signal: sensor.signal,\n                  adc: sensor.adc,\n                  ts: sensor.ts,\n                  mv1: valaueAfterMapping[0],\n                  mv2: valaueAfterMapping[1],\n                  mv3: valaueAfterMapping[2],\n                  originalmv1: sensor.mv1,\n                  originalmv2: sensor.mv2,\n                  originalmv3: sensor.mv3,\n                  altitude: sensor.altitude,\n                  mapping: response.data.dataMapping\n                };\n              });\n              setSensorData(sensors);\n              setAllDataSensor(updatedSensorData);\n              _context.next = 14;\n              break;\n\n            case 11:\n              _context.prev = 11;\n              _context.t0 = _context[\"catch\"](0);\n              console.log(_context.t0);\n\n            case 14:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 11]]);\n    }));\n\n    return function getDataSensor() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    getDataSensor();\n    var intervalId = setInterval(function () {\n      getDataSensor();\n    }, 30000);\n    return function () {\n      return clearInterval(intervalId);\n    };\n  }, []);\n  return allDataSensor;\n};\n\nexport default useSensorData;","map":{"version":3,"names":["React","useEffect","useState","useLocation","api","useSensorData","sensorData","setSensorData","allDataSensor","setAllDataSensor","location","userId","pathname","split","userUid","JSON","parse","localStorage","getItem","id","fieldUid","url","role","data","getDataSensor","post","response","sensors","dataMappings","dataMapping","updatedSensorData","map","sensor","valaueAfterMapping","mappedCharge","date","time","vals","mv1","mv2","mv3","chargeMin","chargeMax","Number","charge","toFixed","Math","max","min","forEach","dateMappings","num","length","dateMappingSelected","keyDataMax","keyDataMin","val","index","parseFloat","code","sensor_id","temperature","humidity","pressure","signal","adc","ts","originalmv1","originalmv2","originalmv3","altitude","mapping","console","log","intervalId","setInterval","clearInterval"],"sources":["C:/Users/HP/Desktop/SmartFarm app/backoffice/frontend/src/utils/useSensorData.js"],"sourcesContent":["import React ,{useEffect,useState} from 'react'\r\nimport { useLocation } from 'react-router-dom';\r\nimport api from '../api/api'\r\n\r\nconst useSensorData = () => {\r\n    const [sensorData, setSensorData] = useState([]);\r\n    const [allDataSensor, setAllDataSensor] = useState([]);\r\n    let location = useLocation()\r\n    let userId = location.pathname.split('/')[2]\r\n    let userUid = JSON.parse(localStorage.getItem('user')).id\r\n    let fieldUid = localStorage.getItem('Field')\r\n    let url = '/sensor/sensor-update-data'\r\n    if((JSON.parse(localStorage.getItem('user')).role === \"ROLE_SUPPLIER\") && location.pathname === `/Fields/${userId}/${fieldUid}`){\r\n      url = '/supplier/sensor-data'\r\n    }\r\n    if((JSON.parse(localStorage.getItem('user')).role === \"ROLE_SUPPLIER\") && location.pathname === `/Dashboard-supplier`){\r\n        url = '/supplier/get-sensors-data'\r\n      }\r\n    let data = {\r\n        userUid : userUid,\r\n        fieldUid : fieldUid,\r\n        userId : userId\r\n      }\r\n      const getDataSensor = async () => {\r\n        try {\r\n            const response = await api.post(url, data);\r\n            const sensors = response.data.sensors;\r\n            const dataMappings = response.data.dataMapping;\r\n    \r\n            const updatedSensorData = sensors.map(sensor => {\r\n                const valaueAfterMapping = [];\r\n                let mappedCharge = 0\r\n                const date = sensor.time;\r\n                const vals = [sensor.mv1, sensor.mv2, sensor.mv3];\r\n                if (sensor) {\r\n                    const chargeMin = 73;\r\n                    const chargeMax = 100;\r\n\r\n                    mappedCharge = ((Number(sensor.charge) - chargeMin) / (chargeMax - chargeMin) * 100).toFixed(2);\r\n                    mappedCharge = Math.max(0, Math.min(100, mappedCharge));\r\n                }\r\n                dataMappings.forEach(dataMapping => {\r\n                    const dateMappings = dataMapping.date;\r\n                    const num = vals.length;\r\n    \r\n                    const dateMappingSelected = dateMappings[`Mv${num}_date`] || \"\";\r\n    \r\n                    if (dateMappingSelected !== \"\") {\r\n                        const keyDataMax = `Mv${num}_max`;\r\n                        const keyDataMin = `Mv${num}_min`;\r\n    \r\n                        if (dateMappingSelected === dateMappings[`Mv${num}_date`]) {\r\n                            vals.forEach((val, index) => {\r\n                                valaueAfterMapping[index] = val;\r\n    \r\n                                if (val >= parseFloat(dataMapping.max[keyDataMax]) && val <= parseFloat(dataMapping.min[keyDataMin])) {\r\n                                    valaueAfterMapping[index] = (((parseFloat(val) - dataMapping.min[keyDataMin]) / (dataMapping.max[keyDataMax] - dataMapping.min[keyDataMin])) * 100).toFixed(2);\r\n                                } else if (val < parseFloat(dataMapping.max[keyDataMax])) {\r\n                                    valaueAfterMapping[index] = 100;\r\n                                } else if (val > parseFloat(dataMapping.min[keyDataMin])) {\r\n                                    valaueAfterMapping[index] = 0;\r\n                                }\r\n                            });\r\n                        }\r\n                    }\r\n                });\r\n                return {\r\n                    code: sensor.code,\r\n                    sensor_id: sensor.sensor_id,\r\n                    time: sensor.time,\r\n                    temperature: sensor.temperature,\r\n                    humidity: sensor.humidity,\r\n                    pressure: sensor.pressure,\r\n                    charge: mappedCharge,\r\n                    signal : sensor.signal,\r\n                    adc: sensor.adc,\r\n                    ts: sensor.ts,\r\n                    mv1: valaueAfterMapping[0],\r\n                    mv2: valaueAfterMapping[1],\r\n                    mv3: valaueAfterMapping[2],\r\n                    originalmv1: sensor.mv1,\r\n                    originalmv2: sensor.mv2,\r\n                    originalmv3: sensor.mv3,\r\n                    altitude: sensor.altitude,\r\n                    mapping: response.data.dataMapping,\r\n                };\r\n            });\r\n    \r\n            setSensorData(sensors);\r\n            setAllDataSensor(updatedSensorData);\r\n        } catch (error) {\r\n            console.log(error);\r\n        }\r\n    };\r\n    \r\n    useEffect(() => {\r\n        getDataSensor();\r\n    \r\n        const intervalId = setInterval(() => {\r\n            getDataSensor();\r\n        }, 30000);\r\n    \r\n        return () => clearInterval(intervalId);\r\n    \r\n    }, []);\r\n    \r\n    return allDataSensor;\r\n}\r\n\r\nexport default useSensorData"],"mappings":"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"},"metadata":{},"sourceType":"module"}