{"ast":null,"code":"import _regeneratorRuntime from \"C:\\\\professional\\\\2K Media\\\\II.develepment\\\\smart farm\\\\smartFarmOldVPS\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/regenerator\";\nimport _asyncToGenerator from \"C:\\\\professional\\\\2K Media\\\\II.develepment\\\\smart farm\\\\smartFarmOldVPS\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"C:\\\\professional\\\\2K Media\\\\II.develepment\\\\smart farm\\\\smartFarmOldVPS\\\\frontend\\\\node_modules\\\\babel-preset-react-app\\\\node_modules\\\\@babel\\\\runtime/helpers/esm/slicedToArray\";\nimport React, { useEffect, useState } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport api from '../api/api';\n\nvar useSensorData = function useSensorData() {\n  var _useState = useState([]),\n      _useState2 = _slicedToArray(_useState, 2),\n      sensorData = _useState2[0],\n      setSensorData = _useState2[1];\n\n  var _useState3 = useState([]),\n      _useState4 = _slicedToArray(_useState3, 2),\n      allDataSensor = _useState4[0],\n      setAllDataSensor = _useState4[1];\n\n  var location = useLocation();\n  var userId = location.pathname.split('/')[2];\n  var userUid = JSON.parse(localStorage.getItem('user')).id;\n  var fieldUid = localStorage.getItem('Field');\n  var url = '/sensor/sensor-update-data';\n\n  if (JSON.parse(localStorage.getItem('user')).role === \"ROLE_SUPPLIER\" && location.pathname === \"/Fields/\".concat(userId, \"/\").concat(fieldUid)) {\n    url = '/supplier/sensor-data';\n  }\n\n  if (JSON.parse(localStorage.getItem('user')).role === \"ROLE_SUPPLIER\" && location.pathname === \"/Dashboard-supplier\") {\n    url = '/supplier/get-sensors-data';\n  }\n\n  var data = {\n    userUid: userUid,\n    fieldUid: fieldUid,\n    userId: userId\n  };\n\n  var getDataSensor = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee() {\n      var response, sensors, dataMappings, updatedSensorData;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.prev = 0;\n              _context.next = 3;\n              return api.post(url, data);\n\n            case 3:\n              response = _context.sent;\n              sensors = response.data.sensors;\n              dataMappings = response.data.dataMapping; // dataMappings is an array\n\n              updatedSensorData = sensors.map(function (sensor) {\n                var valaueAfterMapping = [];\n                var mappedCharge = 0;\n                var date = sensor.time;\n                var vals = [sensor.mv1, sensor.mv2, sensor.mv3];\n\n                if (sensor) {\n                  var chargeMin = 73;\n                  var chargeMax = 100;\n                  mappedCharge = ((Number(sensor.charge) - chargeMin) / (chargeMax - chargeMin) * 100).toFixed(2);\n                  mappedCharge = Math.max(0, Math.min(100, mappedCharge));\n                } // Iterate over dataMappings to apply the correct min/max for each sensor value\n\n\n                dataMappings.forEach(function (dataMapping) {\n                  vals.forEach(function (val, index) {\n                    var keyDataMax = \"Mv\".concat(index + 1, \"_max\"); // Mv1_max, Mv2_max, or Mv3_max\n\n                    var keyDataMin = \"Mv\".concat(index + 1, \"_min\"); // Mv1_min, Mv2_min, or Mv3_min\n\n                    var max = parseFloat(dataMapping.max[keyDataMax]);\n                    var min = parseFloat(dataMapping.min[keyDataMin]); // Debugging: log the values\n\n                    console.log(\"val: \".concat(val, \", max: \").concat(max, \", min: \").concat(min)); // Adjust calculation for when min > max\n\n                    if (val >= max && val <= min) {\n                      valaueAfterMapping[index] = ((parseFloat(val) - min) / (max - min) * 100).toFixed(2);\n                    } else if (val < min) {\n                      valaueAfterMapping[index] = 0;\n                    } else if (val > max) {\n                      valaueAfterMapping[index] = 100;\n                    }\n                  });\n                });\n                return {\n                  code: sensor.code,\n                  sensor_id: sensor.sensor_id,\n                  time: sensor.time,\n                  temperature: sensor.temperature,\n                  humidity: sensor.humidity,\n                  pressure: sensor.pressure,\n                  charge: mappedCharge,\n                  signal: sensor.signal,\n                  adc: sensor.adc,\n                  ts: sensor.ts,\n                  mv1: valaueAfterMapping[0] || sensor.mv1,\n                  // Fallback to original value if mapping fails\n                  mv2: valaueAfterMapping[1] || sensor.mv2,\n                  // Fallback to original value if mapping fails\n                  mv3: valaueAfterMapping[2] || sensor.mv3,\n                  // Fallback to original value if mapping fails\n                  originalmv1: sensor.mv1,\n                  originalmv2: sensor.mv2,\n                  originalmv3: sensor.mv3,\n                  altitude: sensor.altitude,\n                  mapping: response.data.dataMapping\n                };\n              });\n              setSensorData(sensors);\n              setAllDataSensor(updatedSensorData);\n              _context.next = 14;\n              break;\n\n            case 11:\n              _context.prev = 11;\n              _context.t0 = _context[\"catch\"](0);\n              console.log(_context.t0);\n\n            case 14:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee, null, [[0, 11]]);\n    }));\n\n    return function getDataSensor() {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  useEffect(function () {\n    getDataSensor();\n    var intervalId = setInterval(function () {\n      getDataSensor();\n    }, 30000);\n    return function () {\n      return clearInterval(intervalId);\n    };\n  }, []);\n  return allDataSensor;\n};\n\nexport default useSensorData;","map":{"version":3,"names":["React","useEffect","useState","useLocation","api","useSensorData","sensorData","setSensorData","allDataSensor","setAllDataSensor","location","userId","pathname","split","userUid","JSON","parse","localStorage","getItem","id","fieldUid","url","role","data","getDataSensor","post","response","sensors","dataMappings","dataMapping","updatedSensorData","map","sensor","valaueAfterMapping","mappedCharge","date","time","vals","mv1","mv2","mv3","chargeMin","chargeMax","Number","charge","toFixed","Math","max","min","forEach","val","index","keyDataMax","keyDataMin","parseFloat","console","log","code","sensor_id","temperature","humidity","pressure","signal","adc","ts","originalmv1","originalmv2","originalmv3","altitude","mapping","intervalId","setInterval","clearInterval"],"sources":["C:/professional/2K Media/II.develepment/smart farm/smartFarmOldVPS/frontend/src/utils/useSensorData.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useLocation } from 'react-router-dom';\nimport api from '../api/api';\n\nconst useSensorData = () => {\n  const [sensorData, setSensorData] = useState([]);\n  const [allDataSensor, setAllDataSensor] = useState([]);\n  let location = useLocation();\n  let userId = location.pathname.split('/')[2];\n  let userUid = JSON.parse(localStorage.getItem('user')).id;\n  let fieldUid = localStorage.getItem('Field');\n  let url = '/sensor/sensor-update-data';\n\n  if ((JSON.parse(localStorage.getItem('user')).role === \"ROLE_SUPPLIER\") && location.pathname === `/Fields/${userId}/${fieldUid}`) {\n    url = '/supplier/sensor-data';\n  }\n\n  if ((JSON.parse(localStorage.getItem('user')).role === \"ROLE_SUPPLIER\") && location.pathname === `/Dashboard-supplier`) {\n    url = '/supplier/get-sensors-data';\n  }\n\n  let data = {\n    userUid: userUid,\n    fieldUid: fieldUid,\n    userId: userId,\n  };\n\n  const getDataSensor = async () => {\n    try {\n      const response = await api.post(url, data);\n      const sensors = response.data.sensors;\n      const dataMappings = response.data.dataMapping; // dataMappings is an array\n\n      const updatedSensorData = sensors.map(sensor => {\n        const valaueAfterMapping = [];\n        let mappedCharge = 0;\n        const date = sensor.time;\n        const vals = [sensor.mv1, sensor.mv2, sensor.mv3];\n\n        if (sensor) {\n          const chargeMin = 73;\n          const chargeMax = 100;\n\n          mappedCharge = ((Number(sensor.charge) - chargeMin) / (chargeMax - chargeMin) * 100).toFixed(2);\n          mappedCharge = Math.max(0, Math.min(100, mappedCharge));\n        }\n\n        // Iterate over dataMappings to apply the correct min/max for each sensor value\n        dataMappings.forEach(dataMapping => {\n          vals.forEach((val, index) => {\n            const keyDataMax = `Mv${index + 1}_max`; // Mv1_max, Mv2_max, or Mv3_max\n            const keyDataMin = `Mv${index + 1}_min`; // Mv1_min, Mv2_min, or Mv3_min\n\n            let max = parseFloat(dataMapping.max[keyDataMax]);\n            let min = parseFloat(dataMapping.min[keyDataMin]);\n\n            // Debugging: log the values\n            console.log(`val: ${val}, max: ${max}, min: ${min}`);\n\n            // Adjust calculation for when min > max\n            if (val >= max && val <= min) {\n              valaueAfterMapping[index] = (((parseFloat(val) - min) / (max - min)) * 100).toFixed(2);\n            } else if (val < min) {\n              valaueAfterMapping[index] = 0;\n            } else if (val > max) {\n              valaueAfterMapping[index] = 100;\n            }\n          });\n        });\n\n        return {\n          code: sensor.code,\n          sensor_id: sensor.sensor_id,\n          time: sensor.time,\n          temperature: sensor.temperature,\n          humidity: sensor.humidity,\n          pressure: sensor.pressure,\n          charge: mappedCharge,\n          signal: sensor.signal,\n          adc: sensor.adc,\n          ts: sensor.ts,\n          mv1: valaueAfterMapping[0] || sensor.mv1, // Fallback to original value if mapping fails\n          mv2: valaueAfterMapping[1] || sensor.mv2, // Fallback to original value if mapping fails\n          mv3: valaueAfterMapping[2] || sensor.mv3, // Fallback to original value if mapping fails\n          originalmv1: sensor.mv1,\n          originalmv2: sensor.mv2,\n          originalmv3: sensor.mv3,\n          altitude: sensor.altitude,\n          mapping: response.data.dataMapping,\n        };\n      });\n\n      setSensorData(sensors);\n      setAllDataSensor(updatedSensorData);\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  useEffect(() => {\n    getDataSensor();\n\n    const intervalId = setInterval(() => {\n      getDataSensor();\n    }, 30000);\n\n    return () => clearInterval(intervalId);\n  }, []);\n\n  return allDataSensor;\n};\n\nexport default useSensorData;\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}